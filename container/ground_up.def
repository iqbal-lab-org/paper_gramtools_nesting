# Usage: `sudo singularity build built/image_name.img singu_def.def`
# Tested on: singularity v3.4.0-1

BootStrap: docker
From: ubuntu:latest  

%post
    export DEBIAN_FRONTEND=noninteractive

	# essentials
	apt-get update
	apt-get install -y \
	build-essential \
	automake \
	git \
	pkg-config \
	python3 \
	python3-pip \
	wget \
	zlib1g-dev

	pip3 install pip==20.0.2 # upgrade pip


	# analysis tools

	## art_ilmn
	cd ${HOME}
	wget https://www.niehs.nih.gov/research/resources/assets/docs/artsrcmountrainier2016.06.05linux.tgz
	tar xvf artsrcmountrainier2016.06.05linux.tgz
	cp art_src_MountRainier_Linux/art_illumina /usr/bin/
	rm -r artsrcmountrainier2016.06.05linux.tgz art_src_MountRainier_Linux


	## samtools & bcftools
	cd ${HOME}
	apt-get install -y libncurses5-dev
	wget https://github.com/samtools/samtools/releases/download/1.10/samtools-1.10.tar.bz2
	tar -xf samtools-1.10.tar.bz2 && cd samtools-1.10 && ./configure && make && make install

	cd ${HOME}
	wget https://github.com/samtools/bcftools/releases/download/1.10.2/bcftools-1.10.2.tar.bz2
	tar -xf bcftools-1.10.2.tar.bz2 && cd bcftools-1.10.2 && ./configure && make && make install
	

	## bedtools
	wget https://github.com/arq5x/bedtools2/releases/download/v2.29.2/bedtools.static.binary
	chmod a+x bedtools.static.binary && mv bedtools.static.binary /usr/bin/bedtools


	/*************/
	/* gramtools */
	/*************/
	#apt-get install -y g++-8
    #ln -sf /usr/bin/g++-8 /usr/bin/g++ # Default to g++-8

	# gramtools::cortex
	#apt-get install -y python2.7 python2.7-dev r-base

	#pip3 install git+https://github.com/iqbal-lab-org/gramtools@c4f21b8ade0de0f7e8386b6df4e86d849d3045ba


%environment
    export LC_ALL=C

%labels
    Author Brice Letcher
